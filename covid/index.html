<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Paul Schrimpf">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Model - CovidSEIR.jl</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atelier-forest-light.min.css">
        <link href="../assets/Documenter.css" rel="stylesheet">
        <link href="../assets/extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">CovidSEIR.jl</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Package Docs</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">SEIR Model and Results <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">Model</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Results</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../canada/" class="dropdown-item">Canada</a>
</li>
            
<li>
    <a href="../italy/" class="dropdown-item">Italy</a>
</li>
            
<li>
    <a href="../korea/" class="dropdown-item">South Korea</a>
</li>
            
<li>
    <a href="../china/" class="dropdown-item">China</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../license/" class="dropdown-item">License</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../canada/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/schrimpf/CovidSEIR.jl/edit/master/docs/covid.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#data" class="nav-link">Data</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#model" class="nav-link">Model</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#empirical-model" class="nav-link">Empirical Model</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#model-limitations" class="nav-link">Model Limitations</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#single-country-estimates" class="nav-link">Single Country Estimates</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#priors" class="nav-link">Priors</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#estimation" class="nav-link">Estimation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#results" class="nav-link">Results</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#extensions" class="nav-link">Extensions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#about-this-document" class="nav-link">About this document</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></p>
<p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike
4.0 International
License</a></p>
<pre><code class="julia">using Pkg
#Pkg.activate(&quot;.&quot;) # If running on  vse.syzygy.ca, you might need to uncomment this command
#try
  using CovidSEIR
#catch
  #Pkg.add(PackageSpec(url=&quot;https://github.com/schrimpf/CovidSEIR.jl&quot;))
  #using CovidSEIR
#end
using Plots
Plots.pyplot()
using DataFrames, JLD2
jmddir = normpath(joinpath(dirname(Base.find_package(&quot;CovidSEIR&quot;)),&quot;..&quot;,&quot;docs&quot;,&quot;jmd&quot;))
</code></pre>

<pre><code>"/home/paul/.julia/dev/CovidSEIR/docs/jmd"
</code></pre>
<h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h1>
<h1 id="data">Data<a class="headerlink" href="#data" title="Permanent link">&para;</a></h1>
<p>We will use data from <a href="https://github.com/CSSEGISandData/COVID-19">Johns Hopkins University Center for Systems
Science and Engineering</a>. It
is gathered from a variety of sources and updated daily. JHU CSSE uses
the data for <a href="https://coronavirus.jhu.edu/map.html">this interactive
website.</a>. For another course, I
wrote some notes using this data in python
<a href="https://github.com/ubcecon/ECON323_2020/tree/master/extra_notebooks">here.</a></p>
<p>This data has daily cumulative counts of confirmed cases, recoveries,
and deaths in each country (and provinces within some countries).</p>
<pre><code class="julia">covdf = covidjhudata()
describe(covdf)
</code></pre>

<pre><code>11×8 DataFrame. Omitted printing of 2 columns
│ Row │ variable  │ mean      │ min         │ median    │ max        │ nuni
que │
│     │ Symbol    │ Union…    │ Any         │ Union…    │ Any        │ Unio
n…  │
├─────┼───────────┼───────────┼─────────────┼───────────┼────────────┼─────
────┤
│ 1   │ Date      │           │ 2020-01-22  │           │ 2020-03-28 │ 67  
    │
│ 2   │ confirmed │ 486.367   │ 0           │ 0.0       │ 121478     │     
    │
│ 3   │ Province  │           │ Alberta     │           │ Zhejiang   │ 79  
    │
│ 4   │ Country   │           │ Afghanistan │           │ Zimbabwe   │ 177 
    │
│ 5   │ Lat       │ 22.0528   │ -41.4545    │ 23.8298   │ 71.7069    │     
    │
│ 6   │ Long      │ 23.2675   │ -135.0      │ 20.9394   │ 178.065    │     
    │
│ 7   │ deaths    │ 18.9005   │ 0           │ 0.0       │ 10023      │     
    │
│ 8   │ recovered │ 162.121   │ 0           │ 0.0       │ 62098      │     
    │
│ 9   │ iso2c     │           │ AD          │           │ ZW         │ 170 
    │
│ 10  │ cpop      │ 2.27709e8 │ 33785.0     │ 2.49924e7 │ 1.39273e9  │     
    │
│ 11  │ ppop      │ 2.74801e7 │ 41078       │ 1.557e7   │ 111690000  │     
    │
</code></pre>
<h1 id="model">Model<a class="headerlink" href="#model" title="Permanent link">&para;</a></h1>
<p>We will estimate a susceptible, exposed, infectious, recovered (SEIR)
epidemiological model of Covid transmission. In particular, we will use
a version based on <a href="https://alhill.shinyapps.io/COVID19seir/">this webapp by Allison
Hill</a>.</p>
<p>The model contains the following variables, all of which are functions
of time</p>
<ul>
<li>$S$: Susceptible individuals</li>
<li>$E$: Exposed individuals - infected but not yet infectious or
    symptomatic</li>
<li>$I_i$: Undetected infected individuals in severity class $i$.
    Severity increaes with $i$ and we assume individuals must pass
    through all previous classes<ul>
<li>$I_1$: Mild infection</li>
<li>$I_2$: Severe infection</li>
</ul>
</li>
<li>$C_i$ confirmed infected individuals in severity class $i$</li>
<li>$R = R_u + R_c$: individuals who have recovered from disease and are
    now immune<ul>
<li>$R_u$ recovered individuals whose infection were never detected</li>
<li>$R_c$ recovered individuals who were confirmed cases</li>
</ul>
</li>
<li>$X$: Dead individuals</li>
</ul>
<p>Compared to Hill’s model, we have reduced the number of severity classes
and from 3 to 2, and we have added undetected infections and recoveries.
In the data, we observe active confirmed cases $\approx \sum_i C_i$,
deaths $\approx X$, and confirmed recoveries $\approx R_c$.</p>
<p>These variables evolve according to the following system of differential
equations.</p>
<p>
<script type="math/tex; mode=display">
\begin{align*}
\dot{S} & = -S \left( \sum_i \beta_i (I_i + C_i) \right) \\
\dot{E} & = S \left( \sum_i \beta_i (I_i + C_i) \right) - a E  \\
\dot{I_1} & = a E - \gamma_1 I_1 - p_1 I_1 - \tau C_1 \\
\dot{I_2} & = 0 \\
\dot{C_1}  & =  \tau I - \gamma_1 C_1 - p_1 C_1 \\
\dot{C_2} & = p_1(I_1 + C_1) - \gamma_2 C_2 - p_2 C_2 \\
\dot{R_u}  & = \sum_i \gamma_i I_i \\
\dot{R_c} & = \sum_i \gamma_i C_i \\
\dot{X}  & = p_2 C_2
\end{align*}
</script>
</p>
<p>Where the parameters are :</p>
<ul>
<li>$\beta_i$ rate at which infected individuals in class $i$ contact
    susceptibles and infect them</li>
<li>$a$ rate of progression from the exposed to infected class</li>
<li>$\gamma_i$ rate at which infected individuals in class $i$ recover
    from disease and become immune</li>
<li>$p_1$ rate at which infected individuals in class $i$ progress to
    class $i+1$</li>
<li>$p_2$ death rate for individuals in the most severe stage of disease</li>
<li>$\tau$ rate at which infections of class $1$ are detected</li>
</ul>
<p>Note that we are assuming that all severe infections are detected (and
hence $I_2 = 0$). We are also assuming that confirmed and unconfirmed
cases have the same recovery and progression rates.</p>
<h2 id="empirical-model">Empirical Model<a class="headerlink" href="#empirical-model" title="Permanent link">&para;</a></h2>
<p>Our data has country population, $N$, daily cumulative confirmed cases,
$c_t$, deaths, $d_t$, and recoveries, $r_t$. We will assume that at a
known time 0, there is an unknown portion of exposed individuals, $p_0$,
so</p>
<p>
<script type="math/tex; mode=display">
\begin{align*}
S(0) = & (1-p_0) N \\
E(0) = & p_0 N 
\end{align*}
</script>
</p>
<p>and all other model variables are 0 at time 0. We assume that the
observed data is distributed as</p>
<p>
<script type="math/tex; mode=display">
\begin{align*} 
d_t \sim & N(X(t), \sigma_X^2) \\
r_t \sim & N(R_c(t), \sigma_R^2) \\
c_t - d_t - r_t \sim & N(C_1(t) + C_2(t), \sigma_C^2)
\end{align*}
</script>
</p>
<h2 id="model-limitations">Model Limitations<a class="headerlink" href="#model-limitations" title="Permanent link">&para;</a></h2>
<p>An important limitation is that the model assumes all parameters are
constant over time. This is almost surely incorrect. Most countries have
implemented quarantine and distancing policies to attempt to reduce
$\beta$. Efforts have also been made to increase $\tau$. Innovations in
treatment and crowding of the medical system likely lead to variation in
$\gamma$ and $p$.</p>
<h1 id="single-country-estimates">Single Country Estimates<a class="headerlink" href="#single-country-estimates" title="Permanent link">&para;</a></h1>
<h2 id="priors">Priors<a class="headerlink" href="#priors" title="Permanent link">&para;</a></h2>
<p>We use the follow prior distributions. The means of these are loosely
based on <a href="https://alhill.shinyapps.io/COVID19seir/">Hill’s defaults</a>.</p>
<pre><code class="julia">using Distributions
defaultcountrypriors() = Dict(
  &quot;a&quot; =&gt; truncated(Normal(1/5, 3), 1/14, 1.0), 
  &quot;p[1]&quot; =&gt; truncated(Normal(0.05, 0.3), 0, 1),
  &quot;p[2]&quot; =&gt; truncated(Normal(0.05, 0.3), 0, 1),
  &quot;γ[1]&quot; =&gt; truncated(Normal(0.133, 0.5), 0, 3),
  &quot;γ[2]&quot; =&gt; truncated(Normal(0.05, 0.3), 0, 1),
  &quot;β[1]&quot; =&gt; truncated(Normal(0.5, 1), 0, 10),
  &quot;β[2]&quot; =&gt; truncated(Normal(0.5, 1), 0, 10),
  &quot;τ&quot; =&gt; truncated(Normal(0.2, 2), 0, 10),
  &quot;pE0&quot; =&gt; truncated(Normal(0.001, 0.1), 0, 1),
  &quot;sigD&quot; =&gt; InverseGamma(2,3),
  &quot;sigC&quot; =&gt; InverseGamma(2,3),
  &quot;sigRc&quot; =&gt; InverseGamma(2,3))
</code></pre>

<p>Summary statistics of draws from this prior distribution are below.</p>
<pre><code class="julia">pr = priorreport()
pr.tbl
</code></pre>

<pre><code>2-element Array{ChainDataFrame,1}

Summary Statistics
  parameters    mean      std  naive_se    mcse       ess   r_hat
  ──────────  ──────  ───────  ────────  ──────  ────────  ──────
           a  0.5263   0.2802    0.0177  0.0144  253.4545  0.9993
         pE0  0.0790   0.0569    0.0036  0.0013  219.9777  0.9962
        p[1]  0.2529   0.1830    0.0116  0.0114  250.8090  1.0134
        p[2]  0.2775   0.1932    0.0122  0.0136  254.2063  1.0005
        sigC  5.3357  19.4971    1.2331  2.2379  106.4011  1.0048
        sigD  2.6446   2.8749    0.1818  0.0606  255.7700  0.9983
       sigRc  2.9380   3.2822    0.2076  0.3147  183.8356  0.9997
        β[1]  1.0184   0.6905    0.0437  0.0276  177.6735  0.9965
        β[2]  0.9892   0.6673    0.0422  0.0383  306.2808  0.9963
        γ[1]  0.4392   0.3100    0.0196  0.0236  141.3713  1.0004
        γ[2]  0.2534   0.1762    0.0111  0.0172  233.4862  0.9990
           τ  1.6999   1.2119    0.0766  0.0266  194.4783  0.9967

Quantiles
  parameters    2.5%   25.0%   50.0%   75.0%    97.5%
  ──────────  ──────  ──────  ──────  ──────  ───────
           a  0.0882  0.2886  0.5393  0.7772   0.9620
         pE0  0.0024  0.0317  0.0737  0.1120   0.1978
        p[1]  0.0103  0.1069  0.2219  0.3703   0.6743
        p[2]  0.0245  0.1275  0.2323  0.4044   0.7057
        sigC  0.4777  1.0103  2.0044  4.2405  23.2499
        sigD  0.4950  1.0583  1.7059  3.2054  10.6279
       sigRc  0.5365  1.0271  1.8202  3.4039  14.0304
        β[1]  0.0497  0.4025  1.0116  1.4657   2.4971
        β[2]  0.0792  0.4397  0.9270  1.3470   2.4682
        γ[1]  0.0484  0.1741  0.3665  0.6558   1.1198
        γ[2]  0.0132  0.1159  0.2213  0.3556   0.6721
           τ  0.0273  0.7080  1.4394  2.4266   4.3182
</code></pre>
<p>The following plots show the implications of this prior for the observed
data. The faint lines on each figure shows 1000 trajectories sampled
from the prior distribution. The black line is the prior mean. The
shaded region is a pointwise 90% prior credible interval.</p>
<pre><code class="julia">plot(pr.figs[1], xlabel=&quot;Days&quot;, ylabel=&quot;Portion of population&quot;)
</code></pre>

<p><img alt="" src="../figures/covid_5_1.png" /></p>
<pre><code class="julia">plot(pr.figs[2], xlabel=&quot;Days&quot;, ylabel=&quot;Portion of population&quot;)
</code></pre>

<p><img alt="" src="../figures/covid_6_1.png" /></p>
<pre><code class="julia">plot(pr.figs[3], xlabel=&quot;Days&quot;, ylabel=&quot;Portion of population&quot;)
</code></pre>

<p><img alt="" src="../figures/covid_7_1.png" /></p>
<p>Subjectively this prior seems reasonable. It is perhaps too concentrated
on relatively fast epidemics. I may alter it, but it’s what I used for
the current results.</p>
<h2 id="estimation">Estimation<a class="headerlink" href="#estimation" title="Permanent link">&para;</a></h2>
<p>We estimate the model by MCMC. Specifically, we use the
<a href="https://github.com/TuringLang/Turing.jl">Turing.jl</a> package (Ge, Xu,
and Ghahramani <a href="#ref-ge2018t">2018</a>) . For sampling, we use the
No-U-Turn-Sampler variant of Hamiltonian Monte Carlo. In the results
below we use 4 chains with 1000 warmup iterations, and 1000 iterations
for the results.</p>
<h1 id="results">Results<a class="headerlink" href="#results" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="canada">Canada</a></li>
<li><a href="italy">Italy</a></li>
<li><a href="korea">South Korea</a></li>
<li><a href="china">China</a></li>
</ul>
<h1 id="extensions">Extensions<a class="headerlink" href="#extensions" title="Permanent link">&para;</a></h1>
<ol>
<li>Estimate single country model for more countries/areas.</li>
<li>Estimate a multi-country model with some parameters common across
    countries and others multi-level distributions.</li>
<li>Allow time varying parameters.</li>
</ol>
<h1 id="about-this-document">About this document<a class="headerlink" href="#about-this-document" title="Permanent link">&para;</a></h1>
<p>This document was created using Weave.jl. The code is available in <a href="https://github.com/schrimpf/CovidSEIR.jl">on
github</a>.</p>
<div class="references hanging-indent" id="refs">
<div id="ref-ge2018t">
<p>Ge, Hong, Kai Xu, and Zoubin Ghahramani. 2018. “Turing: A Language for
Flexible Probabilistic Inference.” In <em>International Conference on
Artificial Intelligence and Statistics, AISTATS 2018, 9-11 April 2018,
Playa Blanca, Lanzarote, Canary Islands, Spain</em>, 1682–90.
<a href="http://proceedings.mlr.press/v84/ge18b.html">http://proceedings.mlr.press/v84/ge18b.html</a>.</p>
</div>
</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Paul Schrimpf</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML" defer></script>
        <script src="../assets/mathjaxhelper.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
